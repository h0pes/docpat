# ============================================
# DocPat Backend Environment Configuration
# ============================================
# Copy this file to .env and update with your actual values
# NEVER commit the .env file to version control

# ============================================
# APPLICATION SETTINGS
# ============================================

# Server configuration
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
ENVIRONMENT=development  # development, staging, production

# Application name and version
APP_NAME=DocPat
APP_VERSION=1.0.0

# ============================================
# DATABASE CONFIGURATION
# ============================================

# PostgreSQL connection string
# Format: postgres://username:password@host:port/database
DATABASE_URL=postgresql://docpat_user:your_secure_password@localhost:5432/docpat_db

# Database pool settings
DATABASE_MAX_CONNECTIONS=20
DATABASE_MIN_CONNECTIONS=5
DATABASE_CONNECT_TIMEOUT=30
DATABASE_IDLE_TIMEOUT=600

# Enable SQLx query logging (set to false in production)
SQLX_QUERY_LOGGING=true

# ============================================
# REDIS CONFIGURATION (Optional)
# ============================================

# Redis connection string for session caching
REDIS_URL=redis://localhost:6379
REDIS_ENABLED=false
REDIS_POOL_SIZE=10
REDIS_SESSION_TTL=1800  # Session TTL in seconds (30 minutes)

# ============================================
# AUTHENTICATION & SECURITY
# ============================================

# JWT Configuration
# Generate with: openssl rand -base64 64
JWT_SECRET=your_jwt_secret_key_here_generate_with_openssl_rand_base64_64
JWT_REFRESH_SECRET=your_jwt_refresh_secret_key_here_generate_with_openssl_rand_base64_64

# Token expiration times (in seconds)
JWT_ACCESS_TOKEN_EXPIRY=900        # 15 minutes
JWT_REFRESH_TOKEN_EXPIRY=604800    # 7 days

# Argon2 password hashing configuration
ARGON2_MEMORY_COST=65536     # 64 MB
ARGON2_TIME_COST=3           # Number of iterations
ARGON2_PARALLELISM=4         # Number of parallel threads

# Multi-Factor Authentication (TOTP)
MFA_ISSUER=DocPat
MFA_ENABLED=true

# Session configuration
SESSION_TIMEOUT=1800         # 30 minutes inactivity timeout
SESSION_MAX_LIFETIME=43200   # 12 hours max session lifetime

# Account security
MAX_LOGIN_ATTEMPTS=5
ACCOUNT_LOCKOUT_DURATION=900 # 15 minutes lockout after failed attempts

# ============================================
# ENCRYPTION (AES-256)
# ============================================

# Data encryption key for medical records (AES-256)
# Generate with: openssl rand -base64 32
ENCRYPTION_KEY=your_aes_256_encryption_key_here_generate_with_openssl_rand_base64_32

# Encryption algorithm (do not change unless you know what you're doing)
ENCRYPTION_ALGORITHM=AES-256-GCM

# ============================================
# CORS CONFIGURATION
# ============================================

# Allowed origins for CORS (comma-separated)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000
CORS_MAX_AGE=3600
CORS_ALLOW_CREDENTIALS=true

# ============================================
# RATE LIMITING
# ============================================

# Requests per minute
RATE_LIMIT_ANONYMOUS=100
RATE_LIMIT_AUTHENTICATED=300
RATE_LIMIT_ENABLED=true

# ============================================
# LOGGING CONFIGURATION
# ============================================

# Log level: trace, debug, info, warn, error
LOG_LEVEL=info

# Log format: json, pretty
LOG_FORMAT=pretty

# Log file path (leave empty to disable file logging)
LOG_FILE_PATH=./logs/docpat.log

# Enable request/response logging
LOG_REQUESTS=true
LOG_RESPONSES=false  # Set to true only in development

# ============================================
# AUDIT LOGGING
# ============================================

# Audit log settings
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=1095  # 3 years

# ============================================
# FILE UPLOAD CONFIGURATION
# ============================================

# Maximum file upload size (in bytes)
MAX_UPLOAD_SIZE=10485760  # 10 MB

# Allowed file types (comma-separated MIME types)
ALLOWED_FILE_TYPES=image/jpeg,image/png,application/pdf

# Upload directory
UPLOAD_DIR=./uploads

# ============================================
# EMAIL CONFIGURATION (Optional - for document delivery)
# ============================================
#
# SECURITY WARNING: Email credentials are EXTREMELY SENSITIVE.
# - NEVER commit actual credentials to version control
# - NEVER store credentials in the database
# - NEVER log credentials (custom Debug impl prevents this)
# - Credentials are ONLY loaded from this .env file
#
# For Gmail SMTP:
# 1. Enable 2-Factor Authentication on your Google account
# 2. Generate an App Password: https://myaccount.google.com/apppasswords
# 3. Use the App Password (NOT your regular Gmail password) below
# 4. Gmail SMTP settings: smtp.gmail.com:587
#
# SMTP settings for email notifications and document delivery
SMTP_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your_gmail_address@gmail.com
SMTP_PASSWORD=your_16_char_app_password
SMTP_FROM_EMAIL=your_gmail_address@gmail.com
SMTP_FROM_NAME=Dr. Your Name

# ============================================
# SMS CONFIGURATION (Optional)
# ============================================

# SMS provider settings (Twilio, etc.)
SMS_ENABLED=false
SMS_PROVIDER=twilio
SMS_ACCOUNT_SID=your_account_sid
SMS_AUTH_TOKEN=your_auth_token
SMS_FROM_NUMBER=+1234567890

# ============================================
# WHATSAPP CONFIGURATION (Optional)
# ============================================

# WhatsApp Business API settings
WHATSAPP_ENABLED=false
WHATSAPP_API_URL=https://api.whatsapp.com
WHATSAPP_API_KEY=your_api_key
WHATSAPP_FROM_NUMBER=+1234567890

# ============================================
# BACKUP CONFIGURATION
# ============================================

# Automated backup settings
BACKUP_ENABLED=true
BACKUP_DIR=./backups
BACKUP_RETENTION_DAYS=30
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM (cron format)

# GPG encryption for backups
BACKUP_GPG_ENABLED=true
BACKUP_GPG_KEY_ID=your_gpg_key_id

# ============================================
# MONITORING & METRICS
# ============================================

# Prometheus metrics endpoint
METRICS_ENABLED=true
METRICS_PORT=9090

# Health check endpoint
HEALTH_CHECK_ENABLED=true

# ============================================
# DEVELOPMENT SETTINGS
# ============================================

# Enable development features (NEVER set to true in production)
DEV_MODE=true
DEV_SEED_DATABASE=false
DEV_SKIP_MIGRATIONS=false

# ============================================
# TIMEZONE & LOCALIZATION
# ============================================

# Application timezone
TIMEZONE=Europe/Rome

# Default language (en, it)
DEFAULT_LANGUAGE=it

# Supported languages (comma-separated)
SUPPORTED_LANGUAGES=en,it

# ============================================
# PERFORMANCE & CACHING
# ============================================

# Cache TTL settings (in seconds)
CACHE_PATIENT_SEARCH_TTL=300      # 5 minutes
CACHE_APPOINTMENT_LIST_TTL=60     # 1 minute
CACHE_STATIC_DATA_TTL=3600        # 1 hour

# Query timeout (in seconds)
QUERY_TIMEOUT=30

# ============================================
# HIPAA COMPLIANCE
# ============================================

# Enable HIPAA compliance features
HIPAA_MODE=true
HIPAA_AUDIT_ALL_ACCESS=true
HIPAA_ENCRYPT_AT_REST=true

# ============================================
# TLS/SSL CONFIGURATION
# ============================================

# TLS settings (for production deployment)
TLS_ENABLED=false
TLS_CERT_PATH=/etc/ssl/certs/docpat.crt
TLS_KEY_PATH=/etc/ssl/private/docpat.key

# HSTS settings
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000  # 1 year

# ============================================
# TESTING & DEVELOPMENT
# ============================================

# Test database URL (separate from production)
TEST_DATABASE_URL=postgresql://docpat_user:password@localhost:5432/docpat_test

# Enable test mode features
TEST_MODE=false

# ============================================
# FEATURE FLAGS
# ============================================

# Feature toggles
FEATURE_PATIENT_PORTAL=false
FEATURE_TELEMEDICINE=false
FEATURE_DRUG_INTERACTIONS=false
FEATURE_HL7_EXPORT=false
FEATURE_FHIR_EXPORT=false

# ============================================
# THIRD-PARTY INTEGRATIONS
# ============================================

# ICD-10 API (if using external service)
ICD10_API_ENABLED=false
ICD10_API_URL=https://api.example.com/icd10
ICD10_API_KEY=your_api_key

# Lab integration
LAB_INTEGRATION_ENABLED=false
LAB_API_URL=https://api.lab.example.com
LAB_API_KEY=your_lab_api_key

# ============================================
# MAINTENANCE MODE
# ============================================

# Enable maintenance mode
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=System is currently under maintenance. Please try again later.

# ============================================
# NOTES
# ============================================
#
# Security Best Practices:
# 1. Generate strong random secrets using: openssl rand -base64 64
# 2. Use different secrets for each environment (dev, staging, prod)
# 3. Rotate secrets regularly (quarterly minimum)
# 4. Never share or commit the actual .env file
# 5. Use environment-specific .env files (.env.development, .env.production)
# 6. Restrict file permissions: chmod 600 .env
#
# Required Variables for Minimal Setup:
# - DATABASE_URL
# - JWT_SECRET
# - JWT_REFRESH_SECRET
# - ENCRYPTION_KEY
#
# Production Checklist:
# - Set ENVIRONMENT=production
# - Set DEV_MODE=false
# - Enable TLS_ENABLED=true
# - Set strong, unique secrets
# - Configure proper CORS_ORIGINS
# - Enable HIPAA_MODE=true
# - Set appropriate LOG_LEVEL (warn or error)
# - Configure backup settings
# - Enable monitoring and metrics
#
# ============================================
