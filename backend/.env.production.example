# ============================================
# DocPat Backend - PRODUCTION Environment
# ============================================
# This file contains production-appropriate defaults.
# Copy to .env and update with your actual values.
#
# SECURITY CRITICAL:
# - NEVER commit the actual .env file to version control
# - Use strong, unique secrets (generate with: openssl rand -base64 64)
# - Restrict file permissions: chmod 600 .env
# - Rotate secrets quarterly
# ============================================

# ============================================
# APPLICATION SETTINGS
# ============================================

SERVER_HOST=0.0.0.0
SERVER_PORT=8000
ENVIRONMENT=production

APP_NAME=DocPat
APP_VERSION=1.0.0

# ============================================
# TLS/HTTPS CONFIGURATION (REQUIRED)
# ============================================
#
# Option 1: Let's Encrypt (Certbot)
#   sudo certbot certonly --standalone -d yourdomain.com
#   Certificates stored in /etc/letsencrypt/live/yourdomain.com/
#
# Option 2: Commercial Certificate
#   Place your certificate and key files in a secure location
#   Ensure proper file permissions (chmod 600 for key)
#
# Option 3: Behind Reverse Proxy (Nginx/Caddy)
#   If using a reverse proxy that handles TLS termination,
#   set TLS_ENABLED=false and configure proxy instead
#
TLS_ENABLED=true
TLS_CERT_PATH=/etc/letsencrypt/live/yourdomain.com/fullchain.pem
TLS_KEY_PATH=/etc/letsencrypt/live/yourdomain.com/privkey.pem

# HSTS settings (Strict Transport Security)
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000  # 1 year

# ============================================
# DATABASE CONFIGURATION
# ============================================

# Use strong, unique password
DATABASE_URL=postgresql://docpat_prod:CHANGE_THIS_STRONG_PASSWORD@localhost:5432/docpat_production

# Production pool settings
DATABASE_MAX_CONNECTIONS=50
DATABASE_MIN_CONNECTIONS=10
DATABASE_CONNECT_TIMEOUT=30
DATABASE_IDLE_TIMEOUT=600

# Disable query logging in production
SQLX_QUERY_LOGGING=false

# ============================================
# REDIS CONFIGURATION (Recommended for Production)
# ============================================

REDIS_URL=redis://localhost:6379
REDIS_ENABLED=true
REDIS_POOL_SIZE=20
REDIS_SESSION_TTL=1800

# ============================================
# AUTHENTICATION & SECURITY
# ============================================

# CRITICAL: Generate unique secrets for production
# openssl rand -base64 64
JWT_SECRET=GENERATE_NEW_SECRET_WITH_openssl_rand_base64_64
JWT_REFRESH_SECRET=GENERATE_DIFFERENT_SECRET_WITH_openssl_rand_base64_64

# Token expiration (production values)
JWT_ACCESS_TOKEN_EXPIRY=900        # 15 minutes
JWT_REFRESH_TOKEN_EXPIRY=604800    # 7 days

# Argon2 password hashing (production strength)
ARGON2_MEMORY_COST=65536
ARGON2_TIME_COST=3
ARGON2_PARALLELISM=4

# MFA Configuration
MFA_ISSUER=DocPat
MFA_ENABLED=true

# Session configuration
SESSION_TIMEOUT=1800         # 30 minutes
SESSION_MAX_LIFETIME=43200   # 12 hours

# Account security
MAX_LOGIN_ATTEMPTS=5
ACCOUNT_LOCKOUT_DURATION=900 # 15 minutes

# ============================================
# ENCRYPTION (AES-256) - CRITICAL
# ============================================

# CRITICAL: Generate unique encryption key
# openssl rand -base64 32
ENCRYPTION_KEY=GENERATE_NEW_KEY_WITH_openssl_rand_base64_32
ENCRYPTION_ALGORITHM=AES-256-GCM

# ============================================
# CORS CONFIGURATION
# ============================================

# Set to your actual production domain(s)
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
CORS_MAX_AGE=3600
CORS_ALLOW_CREDENTIALS=true

# ============================================
# RATE LIMITING
# ============================================

RATE_LIMIT_ANONYMOUS=100
RATE_LIMIT_AUTHENTICATED=300
RATE_LIMIT_ENABLED=true

# ============================================
# LOGGING CONFIGURATION
# ============================================

# Production: warn or error level only
LOG_LEVEL=warn
LOG_FORMAT=json
LOG_FILE_PATH=/var/log/docpat/docpat.log

# Disable response logging in production
LOG_REQUESTS=true
LOG_RESPONSES=false

# ============================================
# AUDIT LOGGING
# ============================================

AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=1095  # 3 years (HIPAA requirement)

# ============================================
# FILE UPLOAD CONFIGURATION
# ============================================

MAX_UPLOAD_SIZE=10485760  # 10 MB
ALLOWED_FILE_TYPES=image/jpeg,image/png,application/pdf
UPLOAD_DIR=/var/lib/docpat/uploads

# ============================================
# EMAIL CONFIGURATION
# ============================================

SMTP_ENABLED=true
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USERNAME=noreply@yourdomain.com
SMTP_PASSWORD=YOUR_SMTP_PASSWORD_HERE
SMTP_FROM_EMAIL=noreply@yourdomain.com
SMTP_FROM_NAME="DocPat Medical"

# ============================================
# BACKUP CONFIGURATION
# ============================================

BACKUP_ENABLED=true
BACKUP_DIR=/var/backups/docpat
BACKUP_RETENTION_DAYS=30
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM

# GPG encryption for backups
BACKUP_GPG_ENABLED=true
BACKUP_GPG_KEY_ID=YOUR_GPG_KEY_ID

# ============================================
# MONITORING & METRICS
# ============================================

METRICS_ENABLED=true
METRICS_PORT=9090
HEALTH_CHECK_ENABLED=true

# ============================================
# PRODUCTION SETTINGS
# ============================================

# CRITICAL: Must be false in production
DEV_MODE=false
DEV_SEED_DATABASE=false
DEV_SKIP_MIGRATIONS=false
TEST_MODE=false

# ============================================
# TIMEZONE & LOCALIZATION
# ============================================

TIMEZONE=Europe/Rome
DEFAULT_LANGUAGE=it
SUPPORTED_LANGUAGES=en,it

# ============================================
# HIPAA COMPLIANCE
# ============================================

HIPAA_MODE=true
HIPAA_AUDIT_ALL_ACCESS=true
HIPAA_ENCRYPT_AT_REST=true

# ============================================
# MAINTENANCE MODE
# ============================================

MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System is currently under maintenance. Please try again later."

# ============================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ============================================
#
# Before deploying, verify:
#
# [ ] TLS certificates obtained and configured
# [ ] All secrets are unique and strong (JWT, encryption key)
# [ ] Database credentials are secure
# [ ] CORS_ALLOWED_ORIGINS matches your domain
# [ ] DEV_MODE=false
# [ ] LOG_LEVEL=warn or error
# [ ] Firewall configured (only ports 443, 8000)
# [ ] Backup encryption configured
# [ ] Monitoring enabled
# [ ] Admin user created with MFA
# [ ] File permissions restricted (chmod 600 .env)
#
# Certificate Renewal (Let's Encrypt):
#   Add to crontab: 0 0 1 * * certbot renew --quiet
#
# ============================================
